# 岩を押す時の動作

![岩転がし](Images/rock-move.mp4)

岩を転がして、段差に落とす時の動作がぎこちない。

　岩を押すような処理は、2つのオブジェクトが関わってくるので制御が複雑になる。押した後の状況が多岐にわたるため、あらゆる状況を想定した上で、最適なルールを考え出す必要がある。どのように動かしたいかを明確にした上で、実際に発生しうる状況を洗い出して、最適なルールを検討する。

## 目的の動き
- 岩が転がれる間は、ステラの歩きを妨げたくない
- 岩の下が無くなったら、岩は直下に落ちる。その間は、ステラは岩に乗れる高さになるまで移動できなくする
- 岩が着地している時はミニジャンプ可能
- 岩が落下中にミニジャンプをすると座標がズレて飛びすぎてしまうため、段差を乗り越えるのみにする
- 現在、段差を乗り越えようとした後にまた戻るという動きがあるので、乗ったならそのまま乗り切らせたい

## 現状
- ステラが歩く時に前に何かあったら、PushActionを呼び出す
- PushAction側で、ステラの移動分、岩を押す処理を実施。現在の問題は、岩が縁にある時の処理で、岩を設置させ続けられていないため
- 移動量からYの値の算出を試みたが、計算が間違っているらしい

## 解決策
- 岩の半径分、下にキャストして接触点を探す
- 見つけた接点から上にRaycastして、岩の接触候補場所を算出
- 地面との接点が、今の岩の下端より上の時に、高さ調整を処理する
  - 今の岩より接点が下の時は、まだ接触していないので空中ということ
- 岩の接点予定の場所を、地面の接点の場所に補正すれば、確実に設置させられる

以上で解決。

2020/2/2
